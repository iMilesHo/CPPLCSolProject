# 快速开始指南

## 一分钟上手

```bash
# 1. 编译所有版本
./build.sh

# 2. 运行性能对比（推荐首先运行）
./demo_comparison
```

## 三个 Demo 程序

### 1. 性能对比测试 (demo_comparison)

**推荐首先运行！** 并排对比优化前后的性能差异。

```bash
./demo_comparison
```

**你会看到：**

- Before 版本：3.5 秒内唤醒 ~35 次
- After 版本：3.5 秒内仅唤醒 ~4 次
- **唤醒次数减少约 90%！**

---

### 2. 优化前版本 (demo_timermanager_before)

展示基于轮询的实现方式及其性能问题。

```bash
./demo_timermanager_before
```

**关键观察点：**

- 每 100ms 固定轮询一次
- 即使定时器 3 秒后才到期，也会持续唤醒
- 11 秒运行时间内轮询了 106 次！

---

### 3. 优化后版本 (demo_timermanager_after)

展示使用条件变量优化后的高效实现。

```bash
./demo_timermanager_after
```

**关键观察点：**

- 只在定时器到期或状态变化时唤醒
- 没有定时器时完全休眠（零 CPU 占用）
- 11 秒运行时间内仅唤醒 22 次

---

## 核心技术对比

### 优化前（轮询）

```cpp
while (running_) {
    std::this_thread::sleep_for(100ms);  // 固定间隔
    checkAndFireTimers();                 // 每次都检查
}
```

### 优化后（条件变量）

```cpp
while (running_) {
    auto nextExpire = getNextExpireTime();  // 动态计算
    cv_.wait_until(lock, nextExpire);       // 精确等待
    checkAndFireTimers();
}
```

---

## 性能数据速览

| 指标     | Before   | After | 改善  |
| -------- | -------- | ----- | ----- |
| 唤醒次数 | ~35 次   | ~4 次 | 90%↓  |
| 空闲 CPU | 持续消耗 | ~0%   | 100%↓ |
| 响应延迟 | ≤100ms   | 立即  | 100%↑ |

---

## 车载系统应用

这个优化在福特车载网络调度中枢中实际应用，用于：

- 🌐 网络连接超时检测和自动重连
- 💓 以太网/Wi-Fi/蜂窝网络心跳维护
- 🔄 VLAN 虚拟网络生命周期管理
- 📡 TCU 模块定期保活信号
- 🎵 娱乐系统服务延迟启动
- 🔧 诊断数据定期上报

**优化效果：**

- 降低 ECU 功耗
- 提升系统响应速度
- 提高网络服务可靠性
- 符合汽车级软件性能要求

---

## 项目亮点

✨ **完整可运行** - 三个独立的 demo，清晰展示优化效果
✨ **真实场景** - 模拟车载系统实际使用场景
✨ **详细注释** - 代码中标注了所有优化点和问题点
✨ **性能对比** - 直观的数据对比展示优化成果
✨ **生产级代码** - 实际在福特项目中使用的技术方案

---

更多详情请参阅 [README.md](README.md)
