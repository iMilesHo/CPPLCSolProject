# 自平衡二叉树（Self-Balancing Binary Search Tree）

自平衡二叉树（Self-Balancing Binary Search Tree）是指在插入或删除节点时，会自动通过旋转（Rotation）来保持整棵树的高度尽量平衡，从而保证查找、插入、删除操作的时间复杂度接近 **O(log n)**。

---

## 🧩 一、为什么需要旋转？

如果二叉搜索树（BST）在频繁插入时出现一边很高、一边很矮的情况，比如：

```
1
 \
  2
   \
    3
     \
      4
```

它就变得「退化」成了一个链表，查找效率会从 `O(log n)` 降到 `O(n)`。

为防止这种情况，像 **AVL 树**、**红黑树** 这样的自平衡树在插入或删除节点后，会通过**旋转**（rotation）恢复平衡。

---

## ⚙️ 二、旋转的两种基本操作

旋转其实就是在保证「二叉搜索树性质」不变的情况下，调整节点的结构，让树更平衡。
分为两种基本操作：

### **1️⃣ 左旋 (Left Rotation)**

左旋就是“**右边太重了**”，需要把右孩子提上来。

#### ✅ 示例：

假设我们有：

```
    A
     \
      B
     / \
    C   D
```

对节点 A 做**左旋**后：

```
      B
     / \
    A   D
     \
      C
```

#### ✅ 步骤：

1. 让 B 成为新的根；
2. 把 B 的左子树（C）变成 A 的右子树；
3. 把 A 作为 B 的左子树。

#### ✅ 代码伪例：

```cpp
Node* leftRotate(Node* x) {
    Node* y = x->right;     // 取右孩子
    Node* T2 = y->left;     // 保存y的左子树

    y->left = x;            // x成为y的左孩子
    x->right = T2;          // T2成为x的右孩子

    // 更新高度（仅AVL树需要）
    updateHeight(x);
    updateHeight(y);

    return y;               // 新根节点
}
```

---

### **2️⃣ 右旋 (Right Rotation)**

右旋就是“**左边太重了**”，需要把左孩子提上来。

#### ✅ 示例：

```
      C
     /
    B
   / \
  A   D
```

对节点 C 做**右旋**后：

```
      B
     / \
    A   C
       /
      D
```

#### ✅ 步骤：

1. 让 B 成为新的根；
2. 把 B 的右子树（D）变成 C 的左子树；
3. 把 C 作为 B 的右子树。

#### ✅ 代码伪例：

```cpp
Node* rightRotate(Node* y) {
    Node* x = y->left;      // 取左孩子
    Node* T2 = x->right;    // 保存x的右子树

    x->right = y;           // y成为x的右孩子
    y->left = T2;           // T2成为y的左孩子

    updateHeight(y);
    updateHeight(x);

    return x;               // 新根节点
}
```

---

## 🌲 三、常见的四种不平衡类型（以 AVL 树为例）

| 类型  | 失衡原因                         | 旋转方式     |
| ----- | -------------------------------- | ------------ |
| LL 型 | 左左不平衡（左子树的左孩子太高） | 右旋         |
| RR 型 | 右右不平衡（右子树的右孩子太高） | 左旋         |
| LR 型 | 左右不平衡（左子树的右孩子太高） | 先左旋再右旋 |
| RL 型 | 右左不平衡（右子树的左孩子太高） | 先右旋再左旋 |

例如：

**LR 型**

```
     30
    /
   20
     \
      25
```

处理：

1. 先对 20 **左旋**；
2. 再对 30 **右旋**。

---

## 📈 四、旋转后的效果

旋转后，树的高度下降，查找、插入、删除的性能恢复到接近 `O(log n)`。
这就是自平衡的核心思想：

> “通过局部旋转操作，让整体结构重新平衡。”
